function updateBadge(){chrome.tabs.getSelected(null,function(a){if(a||a.url){var b=K.getCurrUA(a.url),c=b&&b.slug;chrome.browserAction.setBadgeBackgroundColor({color:b&&b.domain?[255,0,126,150]:[0,165,113,190]});chrome.browserAction.setBadgeText({text:c||"",tabId:a.id})}})}chrome.tabs.onSelectionChanged.addListener(function(a,b){updateBadge()});chrome.tabs.onUpdated.addListener(function(a,b,c){updateBadge()});
chrome.extension.onRequest.addListener(function(a,b,c){updateBadge();chrome.tabs.getSelected(null,function(a){a&&(chrome.tabs.reload(a.id,{bypassCache:!0},function(){}),chrome.tabs.update(a.id,{selected:!0}))})});
chrome.webRequest.onBeforeSendHeaders.addListener(function(a){var b={},c=a.requestHeaders,d=K.getCurrUA(a.url);if(!d||!d.ua)return{requestHeaders:a.requestHeaders};a=0;for(var e=c.length;a<e;++a)if("User-Agent"==c[a].name){c[a].value=d.ua;break}b.requestHeaders=c;return b},{urls:["http://*/*","https://*/*"]},["blocking","requestHeaders"]);
